<script type="text/javascript">

  var colorNav = function() {
    if($(document).scrollTop() > $('section#instability').offset().top-140) {
      $("nav").addClass("scrolled");
    } else {
      //remove the background property so it comes transparent again (defined in your css)
      $("nav").removeClass("scrolled");
    }
  };

  var closeTooltipOnClick = function (e) {
       // This code if for touch devices only.
       // We want to tooltip to close, when we touch
       // anywhere on the page, except if we touch on
       // the link itself.
       if ($(e.target).closest($el).size()) {
           // We just clicked on the link, so let's
           // not close the tooltip.
           return;
       }
       $('body').off('touchend', closeTooltipOnClick);
       $el.tooltip('close');
   };

  $(document).ready( function() {
    const countyMap = new MapboxMap();
    const myths = new Myths();
    const social = new Social();
    const quoteExplorer = new QuoteExplorer();

    // Food assistance tooltip/callout
    $('.callout').tooltip({
      position: {
        my: "left top+30", at: "center-65 bottom", collision: "flipfit",
        using: function( position, feedback ) {
          $(this).addClass(feedback.vertical).css( position);
        }
      },
      open: function () {
        // We make sure that the tootlip closes on
        // touch devices if there is a touch event anywhere.
        $('body').on('touchend', closeTooltipOnClick);
      },
      close: function (event, ui) {
        ui.tooltip.hover(
          function () {
            $(this).stop(true).fadeTo(400, 1);
          },
          function () {
            $(this).fadeOut("400", function () {
              $(this).remove();
            })
          }
        );
      },
      content: "<strong>Food Assistance in California (CalFresh/SNAP)</strong>\
      <div style='margin-top: 10px;'>SNAP is the Supplemental Nutrition Assistance Program, which\
      is funded by the federal government and administered by the states.\
      In California, it’s known as CalFresh. To qualify, individuals must\
      make less than 130% (200% in CA) of the Federal Poverty Level pre-tax\
      AND less than 100% of the poverty level after taxes and deductions.\
      For a household of two, that’s a monthly income of $1,784 before\
      taxes and $1,372 after taxes. footnote The program provides a maximum\
      of $353 per month for a household of two. Funds are distributed via\
      Electronic Benefit Transfer (EBT) cards that look and function like a\
      debit card.</div>",
    });

    $('.footnote').tooltip({
      content: function () {
        return $(this).prop('title');
      },
      position: {
        my: "left-58 top+30", at: "center bottom", collision: "flipfit",
        using: function( position, feedback ) {
          console.log((feedback.element.left + 60 >= feedback.target.left ? 'left' : 'right'));
          $(this).addClass(feedback.vertical).addClass((feedback.element.left + 60 >= feedback.target.left ? 'left' : 'right')).css( position);
        }
      },
      open: function () {
        // We make sure that the tootlip closes on
        // touch devices if there is a touch event anywhere.
        $('body').on('touchend', closeTooltipOnClick);
      },
      close: function (event, ui) {
        ui.tooltip.hover(
          function () {
            $(this).stop(true).fadeTo(400, 1);
          },
          function () {
            $(this).fadeOut("400", function () {
              $(this).remove();
            })
          }
        );
      }
    });


    // Scroll-top in top section
    $('.scroll-tip').click(function() {
      var navOffset = $('.smint').height();
      var goTo =  $('div#intro-content').position().top-navOffset;
      $("html, body").stop().animate({ scrollTop: goTo }, 1500);
    });

    // Sticky nav
    $('.stickynav').smint({
      'mySelector': 'section',
      'scrollSpeed' : 1500
    });
  });

  // Change nav bar color on scroll
  $(window).on("scroll", function() {
    colorNav();
  });

  $(window).on("load", function() {
    colorNav();
    new WOW().init();
    $('div.intro-header-outer').fadeIn( 1200, function() {
      $('div.intro-header-inner').fadeIn(1000, function() {
        $('div.scroll-tip').addClass("animated heartBeat long");
      });
    });
  })

</script>
